     1 00000000                                 ; naskfunc
     2 00000000                                 ; TAB=4
     3 00000000                                 
     4 00000000                                 [FORMAT "WCOFF"];
     5 00000000                                 [INSTRSET "i486p"];
     6 00000000                                 [BITS 32];
     7 00000000                                 [FILE "naskfunc.nas"]			
     8 00000000                                 
     9 00000000                                 	GLOBAL _io_hlt,_write_mem8,_io_cli,_io_sti,_io_stihlt
    10 00000000                                 	GLOBAL _io_in8,_io_in16,_io_in32
    11 00000000                                 	GLOBAL _io_out8,_io_out16,_io_out32
    12 00000000                                 	GLOBAL _io_load_eflags,_io_store_eflags
    13 00000000                                 	GLOBAL _load_gdtr,_load_idtr
    14 00000000                                 	GLOBAL _asm_inthandler21,_asm_inthandler2c
    15 00000000                                 	EXTERN _inthandler21,_inthandler2c
    16 00000000                                 
    17                                          [SECTION .text]	
    18 00000000                                 
    19 00000000                                 _io_hlt:	
    20 00000000 F4                              	HLT
    21 00000001 C3                              	RET
    22 00000002                                 
    23 00000002                                 _write_mem8:	; write_mem8(int addr, int data)
    24 00000002 8B 4C 24 04                     	MOV     ECX,[ESP+4]
    25 00000006 8A 44 24 08                     	MOV     AL,[ESP+8]
    26 0000000A 88 01                           	MOV     [ECX],AL
    27 0000000C C3                              	RET
    28 0000000D                                 
    29 0000000D                                 _io_cli:
    30 0000000D                                 	CLT
    31 0000000D C3                              	RET
    32 0000000E                                 
    33 0000000E                                 _io_sti:
    34 0000000E FB                              	STI 
    35 0000000F C3                              	RET
    36 00000010                                 
    37 00000010                                 _io_stihlt:
    38 00000010 FB                              	STI 
    39 00000011 F4                              	HLT
    40 00000012 C3                              	RET
    41 00000013                                 
    42 00000013                                 _io_in8:
    43 00000013 8B 54 24 04                     	MOV EDX,[ESP+4]
    44 00000017 B8 00000000                     	MOV EAX,0
    45 0000001C EC                              	IN AL,DX
    46 0000001D C3                              	RET
    47 0000001E                                 
    48 0000001E                                 _io_in16:
    49 0000001E 8B 54 24 04                     	MOV EDX,[ESP+4]
    50 00000022 B8 00000000                     	MOV EAX,0
    51 00000027 66 ED                           	IN AX,DX
    52 00000029 C3                              	RET
    53 0000002A                                 
    54 0000002A                                 _io_in32:
    55 0000002A 8B 54 24 04                     	MOV EDX,[ESP+4]
    56 0000002E ED                              	IN EAX,DX
    57 0000002F                                 
    58 0000002F                                 _io_out8:
    59 0000002F 8B 54 24 04                     	MOV EDX,[ESP+4]
    60 00000033 8A 44 24 08                     	MOV AL,[ESP+8]
    61 00000037 EE                              	OUT DX,AL
    62 00000038 C3                              	RET
    63 00000039                                 
    64 00000039                                 _io_out16:
    65 00000039 8B 54 24 04                     	MOV EDX,[ESP+4]
    66 0000003D 8B 44 24 08                     	MOV EAX,[ESP+8]
    67 00000041 66 EF                           	OUT DX,AX
    68 00000043 C3                              	RET
    69 00000044                                 
    70 00000044                                 _io_out32:
    71 00000044 8B 54 24 04                     	MOV EDX,[ESP+4]
    72 00000048 8B 44 24 08                     	MOV EAX,[ESP+8]
    73 0000004C EF                              	OUT DX,EAX
    74 0000004D C3                              	RET
    75 0000004E                                 
    76 0000004E                                 _io_load_eflags:
    77 0000004E 9C                              	PUSHFD
    78 0000004F 58                              	POP EAX
    79 00000050 C3                              	RET
    80 00000051                                 
    81 00000051                                 _io_store_eflags:
    82 00000051 8B 44 24 04                     	MOV EAX,[ESP+4]
    83 00000055 50                              	PUSH EAX
    84 00000056 9D                              	POPFD
    85 00000057 C3                              	RET
    86 00000058                                 
    87 00000058                                 _load_gdtr:
    88 00000058 66 8B 44 24 04                  	MOV AX,[ESP+4]
    89 0000005D 66 89 44 24 06                  	MOV [ESP+6],AX
    90 00000062 0F 01 54 24 06                  	LGDT [ESP+6]
    91 00000067 C3                              	RET
    92 00000068                                 
    93 00000068                                 _load_idtr:
    94 00000068 66 8B 44 24 04                  	MOV AX,[ESP+4]
    95 0000006D 66 89 44 24 06                  	MOV [ESP+6],AX
    96 00000072 0F 01 5C 24 06                  	LIDT [ESP+6]
    97 00000077 C3                              	RET
    98 00000078                                 
    99 00000078                                 _asm_inthandler21:
   100 00000078 06                              	PUSH	ES
   101 00000079 1E                              	PUSH	DS
   102 0000007A 60                              	PUSHAD
   103 0000007B 89 E0                           	MOV		EAX,ESP
   104 0000007D 50                              	PUSH	EAX
   105 0000007E 66 8C D0                        	MOV		AX,SS
   106 00000081 8E D8                           	MOV		DS,AX
   107 00000083 8E C0                           	MOV		ES,AX
   108 00000085 E8 [00000000]                   	CALL	_inthandler21
   109 0000008A 58                              	POP		EAX
   110 0000008B 61                              	POPAD
   111 0000008C 1F                              	POP		DS
   112 0000008D 07                              	POP		ES
   113 0000008E CF                              	IRETD
   114 0000008F                                 
   115 0000008F                                 _asm_inthandler2c:
   116 0000008F 06                              	PUSH	ES
   117 00000090 1E                              	PUSH	DS
   118 00000091 60                              	PUSHAD
   119 00000092 89 E0                           	MOV		EAX,ESP
   120 00000094 50                              	PUSH	EAX
   121 00000095 66 8C D0                        	MOV		AX,SS
   122 00000098 8E D8                           	MOV		DS,AX
   123 0000009A 8E C0                           	MOV		ES,AX
   124 0000009C E8 [00000000]                   	CALL	_inthandler2c
   125 000000A1 58                              	POP		EAX
   126 000000A2 61                              	POPAD
   127 000000A3 1F                              	POP		DS
   128 000000A4 07                              	POP		ES
   129 000000A5 CF                              	IRETD
